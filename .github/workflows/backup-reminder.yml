name: üîî Daily Backup Reminder

on:
  schedule:
    # Setiap hari jam 16:00 WIB (09:00 UTC)
    - cron: '0 9 * * *'
  workflow_dispatch: # Manual trigger

jobs:
  backup-reminder:
    runs-on: ubuntu-latest
    
    steps:
      - name: üì¢ Send Backup Reminder
        run: |
          echo "üîî REMINDER: Backup database SKP KUA Banjarmasin Utara!"
          echo "üìÖ Date: $(date '+%Y-%m-%d %H:%M:%S')"
          echo ""
          echo "‚ö†Ô∏è  Jangan lupa backup database hari ini!"
          echo "Run di Railway Console:"
          echo "  php artisan backup:database --compress"
          echo ""
          echo "üíæ Simpan backup di local computer juga!"
          
      - name: Create Issue as Reminder
        uses: actions/github-script@v7
        with:
          script: |
            const date = new Date().toISOString().split('T')[0];
            const title = `üîî Backup Reminder - ${date}`;
            const body = `## ‚ö†Ô∏è REMINDER: Backup Database Hari Ini!
            
            ### üìã Checklist:
            - [ ] Login ke Railway Console
            - [ ] Run: \`php artisan backup:database --compress\`
            - [ ] Download backup ke local computer
            - [ ] Verify backup file tidak corrupt
            - [ ] Tutup issue ini setelah backup selesai
            
            ### üìÅ Lokasi Backup:
            \`\`\`
            storage/app/backups/${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}/
            \`\`\`
            
            ### üö® Ingat:
            Data LKH yang pernah hilang TIDAK BISA dikembalikan!
            Backup adalah satu-satunya cara melindungi data!
            
            ---
            *Auto-generated by GitHub Actions*
            *Astagfirullah, jangan sampai data hilang lagi! ü§≤*`;
            
            // Check if there's already an open backup reminder issue today
            const issues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              labels: 'backup-reminder'
            });
            
            const todayIssue = issues.data.find(issue => issue.title.includes(date));
            
            if (!todayIssue) {
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: title,
                body: body,
                labels: ['backup-reminder', 'urgent']
              });
              console.log('‚úÖ Backup reminder issue created!');
            } else {
              console.log('‚ÑπÔ∏è Backup reminder already exists for today');
            }
